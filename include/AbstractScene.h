#ifndef ABSTRACTSCENE_H
#define ABSTRACTSCENE_H

// Qt
#include <QOpenGLFunctions_4_5_Core>
#include <QOpenGLWindow>

////////////////////////////////////////////////////////////////////////////////
/// @file AbstractScene.h
/// @author Ramon Blanquer
/// @version 0.0.1
/// @class AbstractScene
/// @brief Prepares OpenGL so the user just needs to subclass it and
/// redefine initialize() and paint()
///
/// This class will be a member of the OpenGL Window and is in
/// charge to initialize all the OpenGL functions (responsible for function
/// binding).
////////////////////////////////////////////////////////////////////////////////
class AbstractScene: protected QOpenGLFunctions_4_5_Core
{

public:
  //////////////////////////////////////////////////////////////////////////////
  /// @brief Constructor.
  /// @param[in] _window The OpenGL window to associate the scene with.
  //////////////////////////////////////////////////////////////////////////////
  AbstractScene(QOpenGLWindow *_window = 0);

  //////////////////////////////////////////////////////////////////////////////
  /// @brief Virtual destructor. The subclassed one will be called.
  //////////////////////////////////////////////////////////////////////////////
  virtual ~AbstractScene();

  //////////////////////////////////////////////////////////////////////////////
  /// @brief Window getter.
  //////////////////////////////////////////////////////////////////////////////
  QOpenGLWindow* window() const;

  //////////////////////////////////////////////////////////////////////////////
  /// @brief Window context getter.
  //////////////////////////////////////////////////////////////////////////////
  QOpenGLContext* context();

  //////////////////////////////////////////////////////////////////////////////
  /// @brief Window context getter.
  //////////////////////////////////////////////////////////////////////////////
  const QOpenGLContext* context() const;

  //////////////////////////////////////////////////////////////////////////////
  /// @brief Must get called after doing any initialization on the subclassed
  /// variant, as it will bind the OpenGL functions and make them available.
  ///
  /// So subclass, and then call AbstractScene::initialize().
  /// Check Scene::initialize() to see an example.
  //////////////////////////////////////////////////////////////////////////////
  virtual void initialize();

  //////////////////////////////////////////////////////////////////////////////
  /// @brief Pure virtual method for drawing the OpenGL scene. Must be
  /// overwritten when subclassing AbstractScene. See Scene as an example.
  //////////////////////////////////////////////////////////////////////////////
  virtual void paint() = 0;

  //////////////////////////////////////////////////////////////////////////////
  /// @brief Pure virtual method that gets propagated from the Window to the
  /// scene so we can intercept key press events.
  //////////////////////////////////////////////////////////////////////////////
  virtual void keyPressed(QKeyEvent* ev) = 0;

  //////////////////////////////////////////////////////////////////////////////
  /// @brief Pure virtual method that gets called whenever the OpenGL Window
  /// is resized so the appropiate transformations get applied to matrices.
  //////////////////////////////////////////////////////////////////////////////
  virtual void windowResized(int _w, int _h) = 0;

private:
  //////////////////////////////////////////////////////////////////////////////
  /// @brief [Window](@ref Window) associated with the scene.
  //////////////////////////////////////////////////////////////////////////////
  QOpenGLWindow *m_window = nullptr;

};

#endif // ABSTRACTSCENE_H
